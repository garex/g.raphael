<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>gRaphaÃ«l Line Charts</title>
        <script src="../raphael-min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../scale.raphael.js" type="text/javascript" charset="utf-8"></script>
        <script src="../g.raphael.js" type="text/javascript"></script>
        <script src="../g.line.js" type="text/javascript" charset="utf-8"></script>
        <script type='text/javascript' src='http://wp-testing.dev/wp/wp-includes/js/jquery/jquery.js?ver=1.11.1'></script>
<script type='text/javascript'>
var GOLDEN_RATIO = 1.618033988749895;

function goldenHeight(width) {
	return Math.round(width/GOLDEN_RATIO);
}

jQuery(document).ready(function($) {
	var lastWidth = 0;
	var holder = $('#autosizer');

	
	function resizeMe() {
		var currentWidth = holder.width();
		if (currentWidth == lastWidth) {
			return;
		}
		console.log('resize');
		lastWidth = currentWidth;
		holder.height(goldenHeight(lastWidth));
	}
	resizeMe();
	$(window).resize(resizeMe);
});
</script>
<script type="text/javascript" charset="utf-8">jQuery(document).ready(function($) {
if (!Raphael.type) {
	window.holder.innerHTML = 'Unfortunately your browser is a piece of old shit. Sorry.';
	return;
}

var scales = [
	{label: 'One One One One One One', 				value: 10},
	{label: 'Two Two Two Two Two Two Two', 			value: 20},
	{label: 'Three', 								value: 30},
	{label: 'Four', 								value: 20},
	{label: 'Five Five Five Five Five Five Five', 	value: 10}
];

var dataX = [],
	dataY = [];

for (var i=0, iMax = scales.length, middle = Math.ceil(iMax/2); i < iMax; i++) {
	scales[i].angle = 90 * (((i+1) <= middle) ? 0 : 2);
	dataX.push(i);
	dataY.push(scales[i].value);
}

var gcd = function(a,b) { return (!b)?a:gcd(b,a%b); };


var holderWrapper = $('#holderwrapper');
holderWrapper.height(goldenHeight(holderWrapper.width()));

var holder = $('#holder');
var width = holder.width();
holder.height(goldenHeight(width));


var r = new ScaleRaphael("holder", width, holder.height());
this.r = r;

var lastWidth = 0;
function resizeMe() {
	var currentWidth = holderWrapper.width();
	if (currentWidth == lastWidth) {
		return;
	}
	console.log('resize2');
	lastWidth = currentWidth;
	holderWrapper.height(goldenHeight(lastWidth));
	r.changeSize(currentWidth, holderWrapper.height());
}
resizeMe();
$(window).resize(resizeMe);


var lines = r.linechart(
	0, 0, width, goldenHeight(width),
	[dataX, [0,0]], [dataY, [0, 50]],
	{
		gutter: 30,
		dash: '-',
		colors: ['#888'],
		symbol: "circle",
		axisxstep: scales.length - 1,
		axis: "0 0 1 1",
		smooth: true
	});

var items = lines.axis[0].text.items;
var columnGutter = 10;
var maxWidth = width/scales.length - columnGutter;
for (var i = 0, iMax = items.length, iLast = iMax - 1; i<iMax; i++) {
	var align   = 'middle',
		divisor = 1;
	if (i == 0) {
		align 	= 'start';
		divisor = 2;
	} else if (i == iLast) {
		align 	= 'end';
		divisor = 2;
	}
	items[i].attr('text-anchor', align);
	fitWidth(items[i], scales[i].label, maxWidth/divisor);
}


for( var i = 0, l = lines.axis.length; i < l; i++ ) {
  // change the axis and tick-marks 
  lines.axis[i].attr("stroke", "#999999");
               
  // change the axis labels 
  var axisItems = lines.axis[i].text.items
  for( var ii = 0, ll = axisItems.length; ii < ll; ii++ ) {
     axisItems[ii].attr("fill", "#999999");
  }
}

function fitWidth(label, text, maxWidth) {
	var words = text.split(' ');
	var add = '';
	for (var i=words.length; i > 0; i--) {
		var current = words.join(' ') + add;
		label.attr('text', current);
		if (i == 0 || maxWidth > label.getBBox().width) {
			return;
		}
		add = '...';
		words.splice(-1, 1);
	}
}

lines.symbols[1].remove();

lines.eachColumn(function() {
	/*var isBorder = (this.axis == 0 || this.axis == (items.length - 1));
	if (isBorder) {
		this.symbols.remove(); return;
	}*/
	this.symbols.attr({fill: Raphael.getColor(0.8)})
})

lines.hoverColumn(function () {
	this.tags = r.set();
	var tag = r.tag(this.x, this.y[0], scales[this.axis].label + '\n' + this.values[0], scales[this.axis].angle, 6)
		.insertBefore(this)
		.attr([{fill: "#fff" }, {fill: "#000"}])
	this.tags.push(tag);
}, function () {
	this.tags && this.tags.remove();
});

});</script>
    </head>
    <body style="background: gainsboro">
    	<div id="holderwrapper" style="width: 60%; background: white;"><div id="holder"></div></div>
        <hr>
        <div id="autosizer" style="width: 50%; min-width: 500px; max-width: 700px; height: 10px; background: green;"></div>
    </body>
</html>
